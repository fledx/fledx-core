# fledx Node Agent Configuration
# Copy this file to .env.agent and adjust the values for your environment

# Control Plane Connection (REQUIRED)
# Point this to your control plane server
FLEDX_AGENT_CONTROL_PLANE_URL=http://localhost:8080

# Node Identity (REQUIRED - obtained from node registration)
# Run: fledx nodes register --name my-node
# Then copy the node_id and node_token from the output
FLEDX_AGENT_NODE_ID=00000000-0000-0000-0000-000000000000
FLEDX_AGENT_NODE_TOKEN=change-me-node-token

# Node Metadata
FLEDX_AGENT_PUBLIC_HOST=127.0.0.1
FLEDX_AGENT_ARCH=x86_64
FLEDX_AGENT_OS=linux
# Comma-separated key=value pairs for node labels
FLEDX_AGENT_LABELS=region=local,env=dev

# Node Capacity
# CPU in millicores (1000 = 1 CPU core)
FLEDX_AGENT_CAPACITY_CPU_MILLIS=4000
# Memory in bytes (8589934592 = 8GB)
FLEDX_AGENT_CAPACITY_MEMORY_BYTES=8589934592

# Heartbeat Configuration
FLEDX_AGENT_HEARTBEAT_INTERVAL_SECS=30
FLEDX_AGENT_HEARTBEAT_TIMEOUT_SECS=5
FLEDX_AGENT_HEARTBEAT_MAX_RETRIES=3

# Resource Monitoring
FLEDX_AGENT_RESOURCE_SAMPLE_INTERVAL_SECS=30
FLEDX_AGENT_RESOURCE_SAMPLE_WINDOW=120

# Container Management
FLEDX_AGENT_RECONCILE_INTERVAL_SECS=10
FLEDX_AGENT_CLEANUP_ON_SHUTDOWN=false

# Restart Policy
FLEDX_AGENT_RESTART_BACKOFF_MS=1000
FLEDX_AGENT_RESTART_BACKOFF_MAX_MS=30000
FLEDX_AGENT_RESTART_FAILURE_LIMIT=5

# TLS Settings
# Set to true only for development/testing!
FLEDX_AGENT_ALLOW_INSECURE_HTTP=true
FLEDX_AGENT_TLS_INSECURE_SKIP_VERIFY=false
# For production with custom CA:
# FLEDX_AGENT_CA_CERT_PATH=/etc/fledx/ca.crt

# Volume Management
# Comma-separated list of allowed volume path prefixes
# For a single path:
FLEDX_AGENT_ALLOWED_VOLUME_PREFIXES=/var/lib/fledx/volumes
# For multiple paths, separate with commas:
# FLEDX_AGENT_ALLOWED_VOLUME_PREFIXES=/var/lib/fledx/volumes,/data,/mnt/storage
FLEDX_AGENT_VOLUME_DATA_DIR=/var/lib/fledx

# Secrets Management
FLEDX_AGENT_SECRETS_DIR=/var/run/secrets
FLEDX_AGENT_SECRETS_PREFIX=FLEDX_SECRET_

# Tunnel Configuration
FLEDX_AGENT_TUNNEL_ENDPOINT_HOST=127.0.0.1
FLEDX_AGENT_TUNNEL_ENDPOINT_PORT=49423
FLEDX_AGENT_TUNNEL_USE_TLS=false

# Envoy Gateway (Public Ingress)
FLEDX_AGENT_GATEWAY_ENABLED=false
# IMPORTANT: When gateway.enabled=true, you MUST specify the Envoy image:
# FLEDX_AGENT_GATEWAY_ENVOY_IMAGE=envoyproxy/envoy:v1.33-latest
FLEDX_AGENT_GATEWAY_ADMIN_PORT=49441
FLEDX_AGENT_GATEWAY_LISTENER_PORT=49442
FLEDX_AGENT_GATEWAY_XDS_PORT=18000

# Prometheus Metrics
FLEDX_AGENT_METRICS_HOST=127.0.0.1
FLEDX_AGENT_METRICS_PORT=49431

# Logging
# Options: error, warn, info, debug, trace
RUST_LOG=info,fledx=debug
