# fledx Node Agent Configuration
# Copy this file to .env.agent and adjust the values for your environment

# Control Plane Connection (REQUIRED)
# Point this to your control plane server
FLEDX_AGENT__CONTROL_PLANE_URL=http://localhost:8080

# Node Identity (REQUIRED - obtained from node registration)
# Run: fledx nodes register --name my-node
# Then copy the node_id and node_token from the output
FLEDX_AGENT__NODE_ID=00000000-0000-0000-0000-000000000000
FLEDX_AGENT__NODE_TOKEN=change-me-node-token

# Node Metadata
FLEDX_AGENT__PUBLIC_HOST=127.0.0.1
FLEDX_AGENT__ARCH=x86_64
FLEDX_AGENT__OS=linux
# Comma-separated key=value pairs for node labels
FLEDX_AGENT__LABELS=region=local,env=dev

# Node Capacity
# CPU in millicores (1000 = 1 CPU core)
FLEDX_AGENT__CAPACITY_CPU_MILLIS=4000
# Memory in bytes (8589934592 = 8GB)
FLEDX_AGENT__CAPACITY_MEMORY_BYTES=8589934592

# Heartbeat Configuration
FLEDX_AGENT__HEARTBEAT_INTERVAL_SECS=30
FLEDX_AGENT__HEARTBEAT_TIMEOUT_SECS=5
FLEDX_AGENT__HEARTBEAT_MAX_RETRIES=3

# Resource Monitoring
FLEDX_AGENT__RESOURCE_SAMPLE_INTERVAL_SECS=30
FLEDX_AGENT__RESOURCE_SAMPLE_WINDOW=120

# Container Management
FLEDX_AGENT__RECONCILE_INTERVAL_SECS=10
FLEDX_AGENT__CLEANUP_ON_SHUTDOWN=false

# Restart Policy
FLEDX_AGENT__RESTART_BACKOFF_MS=1000
FLEDX_AGENT__RESTART_BACKOFF_MAX_MS=30000
FLEDX_AGENT__RESTART_FAILURE_LIMIT=5

# TLS Settings
# Set to true only for development/testing!
FLEDX_AGENT__ALLOW_INSECURE_HTTP=true
FLEDX_AGENT__TLS_INSECURE_SKIP_VERIFY=false
# For production with custom CA:
# FLEDX_AGENT__CA_CERT_PATH=/etc/fledx/ca.crt

# Volume Management
# Comma-separated list of allowed volume path prefixes
# For a single path:
FLEDX_AGENT__ALLOWED_VOLUME_PREFIXES=/var/lib/fledx/volumes
# For multiple paths, separate with commas:
# FLEDX_AGENT__ALLOWED_VOLUME_PREFIXES=/var/lib/fledx/volumes,/data,/mnt/storage
FLEDX_AGENT__VOLUME_DATA_DIR=/var/lib/fledx

# Secrets Management
FLEDX_AGENT__SECRETS_DIR=/var/run/secrets
FLEDX_AGENT__SECRETS_PREFIX=FLEDX_SECRET_

# Tunnel Configuration
FLEDX_AGENT__TUNNEL__ENDPOINT_HOST=127.0.0.1
FLEDX_AGENT__TUNNEL__ENDPOINT_PORT=7443
FLEDX_AGENT__TUNNEL__USE_TLS=false

# Envoy Gateway (Public Ingress)
FLEDX_AGENT__GATEWAY__ENABLED=false
# IMPORTANT: When gateway.enabled=true, you MUST specify the Envoy image:
# FLEDX_AGENT__GATEWAY__ENVOY_IMAGE=envoyproxy/envoy:v1.33-latest
FLEDX_AGENT__GATEWAY__ADMIN_PORT=9901
FLEDX_AGENT__GATEWAY__LISTENER_PORT=10000
FLEDX_AGENT__GATEWAY__XDS_PORT=18000

# Prometheus Metrics
FLEDX_AGENT__METRICS_HOST=127.0.0.1
FLEDX_AGENT__METRICS_PORT=9091

# Logging
# Options: error, warn, info, debug, trace
RUST_LOG=info,fledx=debug
